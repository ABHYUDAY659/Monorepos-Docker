# Use Node 20 Alpine image
FROM node:20-alpine

# Set working directory
WORKDIR /app

# Copy the entire monorepo
COPY . .

# Generate Prisma client
RUN cd packages/db && npx prisma generate

# Move to backend app and install dependencies
WORKDIR /app/apps/backend
RUN npm install

# Build the backend (for TypeScript)
RUN npm run build

# Run the built JS file
CMD ["node", "dist/index.js"]
